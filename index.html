<!DOCTYPE html>
<html>

<body>
  <div id="root"></div>
</body>
<!-- This setup is not suitable for production. -->
<!-- Only use it in development! -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script async src="https://ga.jspm.io/npm:es-module-shims@1.7.0/dist/es-module-shims.js"></script>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react?dev",
    "react-dom/client": "https://esm.sh/react-dom/client?dev"
  }
}
</script>
<script type="text/babel" data-type="module">
import React, { StrictMode } from 'react';
import { createRoot } from 'react-dom/client';
import { useState } from 'react';

// å®šä¹‰æ£‹ç›˜å¤§å°ä¸º20x20
const BOARD_SIZE = 20;

// åˆ¤æ–­æ˜¯å¦äº”å­è¿ç 
function checkWin(squares, currentPlayer) {
  const directions = [
    // æ°´å¹³æ–¹å‘
    { dx: 1, dy: 0 },
    // å‚ç›´æ–¹å‘
    { dx: 0, dy: 1 },
    // æ­£æ–œæ–¹å‘
    { dx: 1, dy: 1 },
    // åæ–œæ–¹å‘
    { dx: 1, dy: -1 }
  ];

  for (let row = 0; row < BOARD_SIZE; row++) {
    for (let col = 0; col < BOARD_SIZE; col++) {
      if (squares[row][col] === currentPlayer) {
        for (let i = 0; i < directions.length; i++) {
          const { dx, dy } = directions[i];
          let count = 1;
          // å‘ä¸€ä¸ªæ–¹å‘éå†
          for (let step = 1; step < 5; step++) {
            const newRow = row + step * dy;
            const newCol = col + step * dx;
            if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE && squares[newRow][newCol] === currentPlayer) {
              count++;
            } else {
              break;
            }
          }
          // å‘ç›¸åæ–¹å‘éå†
          for (let step = 1; step < 5; step++) {
            const newRow = row - step * dy;
            const newCol = col - step * dx;
            if (newRow >= 0 && newRow < BOARD_SIZE && newCol >= 0 && newCol < BOARD_SIZE && squares[newRow][newCol] === currentPlayer) {
              count++;
            } else {
              break;
            }
          }
          if (count >= 5) {
            return true;
          }
        }
      }
    }
  }
  return false;
}

function Square({ row, col, value, onSquareClick }) {
  return (
    <button className="square" onClick={() => onSquareClick(row, col)}>
      {value}
    </button>
  );
}

function Board({ xIsNext, squares, onPlay }) {
  const [gameOver, setGameOver] = useState(false); // æ–°å¢çŠ¶æ€ç”¨äºæ ‡è®°æ¸¸æˆæ˜¯å¦ç»“æŸ
  const [winnerPlayer, setWinnerPlayer] = useState(''); // æ–°å¢çŠ¶æ€ç”¨äºè®°å½•èƒœåˆ©çš„ç©å®¶

  function handleClick(row, col) {
    if (gameOver) {
      return; // å¦‚æœæ¸¸æˆå·²ç»“æŸï¼Œç›´æ¥ä¸å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼Œé˜»æ­¢è½å­
    }
    const currentPlayer = xIsNext? 'X' : 'O';
    const nextSquares = JSON.parse(JSON.stringify(squares));
    if (xIsNext) {
      nextSquares[row][col] = 'X';
    } else {
      nextSquares[row][col] = 'O';
    }
    // å…ˆåˆ¤æ–­è½å­åçš„æ£‹ç›˜çŠ¶æ€æ˜¯å¦äº”å­è¿ç ï¼Œå¦‚æœæ˜¯åˆ™ç›´æ¥åˆ¤å®šèƒœåˆ©å¹¶ç»“æŸæ¸¸æˆ
    if (checkWin(nextSquares, currentPlayer)) {
      onPlay(nextSquares);
      setGameOver(true); // æ ‡è®°æ¸¸æˆç»“æŸ
      setWinnerPlayer(currentPlayer); // è®°å½•èƒœåˆ©çš„ç©å®¶
      return;
    }
    // æ­£å¸¸æƒ…å†µä¸‹å°†è½å­åçš„çŠ¶æ€ä¼ é€’ç»™çˆ¶ç»„ä»¶è¿›è¡Œæ›´æ–°
    onPlay(nextSquares);
  }

  let status;
  if (winnerPlayer) {
    status = `ğŸ‰ æ­å–œç©å®¶ ${winnerPlayer} è·å¾—èƒœåˆ©ï¼ğŸ‰`;
  } else if (!gameOver) {
    status = `ä¸‹ä¸€ä½ç©å®¶ï¼š${xIsNext? 'X' : 'O'}`;
  } else {
    status = 'æ¸¸æˆç»“æŸ';
  }

  return (
    <>
      <div className="status">{status}</div>
      {/* ä½¿ç”¨flexå¸ƒå±€æ¥ç¡®ä¿æ¯è¡Œæ–¹å—æ’åˆ—æ•´é½ */}
      <div className="board" style={{ display: 'flex', flexDirection: 'column' }}>
        {Array.from({ length: BOARD_SIZE }).map((_, rowIndex) => (
          <div className="board-row" key={rowIndex} style={{ display: 'flex' }}>
            {Array.from({ length: BOARD_SIZE }).map((_, colIndex) => (
              <Square
                key={`square-${rowIndex}-${colIndex}`}
                row={rowIndex}
                col={colIndex}
                value={squares[rowIndex][colIndex]}
                onSquareClick={handleClick}
              />
            ))}
          </div>
        ))}
      </div>
    </>
  );
}

let App = function Game() {
  // åˆå§‹åŒ–20x20çš„æ£‹ç›˜çŠ¶æ€
  const [history, setHistory] = useState([Array(BOARD_SIZE).fill().map(() => Array(BOARD_SIZE).fill(null))]);
  // å½“å‰æ­¥æ•°
  const [currentMove, setCurrentMove] = useState(0);
  const xIsNext = currentMove % 2 === 0;
  const currentSquares = history[currentMove];

  function handlePlay(nextSquares) {
    const nextHistory = [...history.slice(0, currentMove + 1), nextSquares];
    setHistory(nextHistory);
    setCurrentMove(nextHistory.length - 1);
  }

  function jumpTo(nextMove) {
    setCurrentMove(nextMove);
  }

  const moves = history.map((squares, move) => {
    let description;
    if (move > 0) {
      description = 'å‰å¾€ç¬¬ #' + move + ' æ­¥';
    } else {
      description = 'å›åˆ°æ¸¸æˆå¼€å§‹';
    }
    return (
      <li key={move}>
        <button onClick={() => jumpTo(move)}>{description}</button>
      </li>
    );
  });

  return (
    <div className="game">
      <div className="game-board">
        <Board xIsNext={xIsNext} squares={currentSquares} onPlay={handlePlay} />
      </div>
      <div className="game-info">
        <ol>{moves}</ol>
      </div>
    </div>
  );
}

const root = createRoot(document.getElementById('root'));
root.render(
  <StrictMode>
    <App />
  </StrictMode>
);
</script>
<style>
* {
  box-sizing: border-box;
}

body {
  font-family: sans-serif;
  margin: 20px;
  padding: 0;
}

h1 {
  margin-top: 0;
  font-size: 22px;
}

h2 {
  margin-top: 0;
  font-size: 20px;
}

h3 {
  margin-top: 0;
  font-size: 18px;
}

h4 {
  margin-top: 0;
  font-size: 16px;
}

h5 {
  margin-top: 0;
  font-size: 14px;
}

h6 {
  margin-top: 0;
  font-size: 12px;
}

code {
  font-size: 1.2em;
}

ul {
  padding-inline-start: 20px;
}

.square {
  background: #fff;
  border: 1px solid #999;
  font-size: 18px;
  font-weight: bold;
  line-height: 26px;
  height: 32px;
  margin: 0; /* å»é™¤ä¹‹å‰çš„è´Ÿè¾¹è· */
  padding: 0;
  text-align: center;
  width: 32px;
}

.status {
  margin-bottom: 10px;
  font-size: 18px;
}

.game {
  display: flex;
  flex-direction: row;
}

.game-info {
  margin-left: 20px;
}

/* è°ƒæ•´æ£‹ç›˜æ•´ä½“æ ·å¼ */
.game-board {
  width: fit-content;
  display: flex;
  flex-direction: column;
}

.board-row {
  display: flex;
  justify-content: flex-start; /* ç¡®ä¿æ–¹å—ä»å·¦åˆ°å³æ’åˆ— */
}

</style>
</html>